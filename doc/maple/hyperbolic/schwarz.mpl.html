<html>
 <head>
 </head>
 <body>
  <pre>
    <a name="line_1"></a># The schwarzian differential operator
<a name="line_2"></a>
<a name="line_3"></a><span style="color:red">#@ schwarzian
</span><a name="line_4"></a>schwarzian :=
<a name="line_5"></a> (f,z) -> diff(f,z,z,z)/diff(f,z) - (3/2) * (diff(f,z,z)/diff(f,z))^2;
<a name="line_6"></a>
<a name="line_7"></a># This is as in Proposition prop-S-p-inv
<a name="line_8"></a><span style="color:red">#@ S_p_inv
</span><a name="line_9"></a>S_p_inv :=
<a name="line_10"></a> unapply((3/8)*(1/z^2 + 1/(z-a_P)^2 + 1/(z+a_P)^2 + 1/(z-1/a_P)^2 + 1/(z+1/a_P)^2) +
<a name="line_11"></a>         (d_p_inv*z - 3*z^3/2)/r_P(z),z);
<a name="line_12"></a>
<a name="line_13"></a># These functions are as in Definition defn-schwarz-phi
<a name="line_14"></a>schwarz_phi     := (z) -> (I - z)/(I + z);        <span style="color:red">#@ schwarz_phi    
</span><a name="line_15"></a>schwarz_phi_inv := (w) -> I * (1 - w)/(1 + w);    <span style="color:red">#@ schwarz_phi_inv
</span><a name="line_16"></a>
<a name="line_17"></a><span style="color:red">#@ schwarz_psi
</span><a name="line_18"></a>schwarz_psi :=
<a name="line_19"></a> (w) -> ((1 + I)/sqrt(2)*(sqrt(2)-am_H-w*ap_H))/(ap_H + (am_H-sqrt(2))*w);
<a name="line_20"></a>
<a name="line_21"></a><span style="color:red">#@ schwarz_psi_inv
</span><a name="line_22"></a>schwarz_psi_inv :=
<a name="line_23"></a> (z) -> (-(sqrt(2) - am_H - (1-I)/sqrt(2)*ap_H*z))/((1-I)*(1-am_H/sqrt(2))*z - ap_H);
<a name="line_24"></a>
<a name="line_25"></a>schwarz_alpha := (I - a_P)/(I + a_P);  <span style="color:red">#@ schwarz_alpha
</span><a name="line_26"></a>
<a name="line_27"></a># This is s^*_0 in Proposition prop-p-one
<a name="line_28"></a><span style="color:red">#@ S0_p1_inv
</span><a name="line_29"></a>S0_p1_inv := (z) -> (9/2*(1-z^2)^4*(1-a_P^4)^2+96*a_P^4*z^2*(1+z^2)^2)/
<a name="line_30"></a>                    ((1-z^2)^2*((1-z^2)^2*(1+a_P^2)^2+16*a_P^2*z^2)^2);
<a name="line_31"></a>
<a name="line_32"></a># This is s^*_1 in Proposition prop-p-one
<a name="line_33"></a><span style="color:red">#@ S1_p1_inv
</span><a name="line_34"></a>S1_p1_inv := (z) -> -4*a_P^2/((1-z^2)^2*(1+a_P^2)^2+16*a_P^2*z^2);
<a name="line_35"></a>
<a name="line_36"></a><span style="color:red">#@ S_p1_inv 
</span><a name="line_37"></a>S_p1_inv  := unapply(S0_p1_inv(z) + S1_p1_inv(z) * d_p_inv, z);
<a name="line_38"></a>
<a name="line_39"></a># We take p2 = xi o p1 as in Remark rem-heun
<a name="line_40"></a>schwarz_xi := (z) -> 2/(z^2+1/z^2);               <span style="color:red">#@ schwarz_xi
</span><a name="line_41"></a>schwarz_xi_inv := (Z) -> sqrt((sqrt(1-Z^2)-1)/Z); <span style="color:red">#@ schwarz_xi_inv
</span><a name="line_42"></a>
<a name="line_43"></a># Schwarzian of the inverse of p2
<a name="line_44"></a><span style="color:red">#@ S0_p2_inv
</span><a name="line_45"></a>S0_p2_inv := (Z) -> 3/16*(9*Z^4*a_P^8+15*Z^3*a_P^8-72*Z^4*a_P^6+5*Z^2*a_P^8-48*Z^3*a_P^6+Z*a_P^8+254*Z^4*a_P^4+2*a_P^8-190*Z^3*a_P^4-16*Z*a_P^6-72*Z^4*a_P^2+150*Z^2*a_P^4+8*a_P^6-48*Z^3*a_P^2-34*Z*a_P^4+9*Z^4+12*a_P^4+15*Z^3-16*Z*a_P^2+5*Z^2+8*a_P^2+Z+2)/Z^2/(Z-1)^2/(Z+1)^2/(Z*a_P^4+a_P^4-6*Z*a_P^2+2*a_P^2+Z+1)^2;
<a name="line_46"></a>
<a name="line_47"></a><span style="color:red">#@ S1_p2_inv
</span><a name="line_48"></a>S1_p2_inv := (Z) -> -1/2*a_P^2/(Z*a_P^4+a_P^4-6*Z*a_P^2+2*a_P^2+Z+1)/(Z+1)/Z/(Z-1);
<a name="line_49"></a>
<a name="line_50"></a><span style="color:red">#@ S_p2_inv
</span><a name="line_51"></a>S_p2_inv := unapply(S0_p2_inv(Z) + d_p_inv * S1_p2_inv(Z),Z);
<a name="line_52"></a>
<a name="line_53"></a><span style="color:red">#@ heun_F00
</span><a name="line_54"></a>heun_F00 := (Z) -> Z^(1/4)*(Z-1)^(1/4)*(Z+1)^(3/8)*((Z+1)*a_P^4+(-6*Z+2)*a_P^2+Z+1)^( 1/8);
<a name="line_55"></a>
<a name="line_56"></a><span style="color:red">#@ heun_F10
</span><a name="line_57"></a>heun_F10 := (Z) -> Z^(3/4)*(Z-1)^(1/4)*(Z+1)^(3/8)*((Z+1)*a_P^4+(-6*Z+2)*a_P^2+Z+1)^(-3/8);
<a name="line_58"></a>
<a name="line_59"></a><span style="color:red">#@ heun_F01
</span><a name="line_60"></a>heun_F01 := (Z) -> HeunG(-4*a_P^2/(a_P^4-2*a_P^2+1),
<a name="line_61"></a>                        (5*a_P^4+5+(-8*d_p_inv-10)*a_P^2)/(64*a_P^4-128*a_P^2+64),
<a name="line_62"></a>			1/8, 5/8, 1/2, 3/4,
<a name="line_63"></a>			-8*Z*a_P^2/((Z+1)*a_P^4+(-6*Z+2)*a_P^2+Z+1));
<a name="line_64"></a>
<a name="line_65"></a><span style="color:red">#@ heun_F11
</span><a name="line_66"></a>heun_F11 := (Z) -> HeunG(-4*a_P^2/(a_P^4-2*a_P^2+1),
<a name="line_67"></a>			 (21+21*a_P^4+(-8*d_p_inv-138)*a_P^2)/(64*a_P^4-128*a_P^2+64),
<a name="line_68"></a>			 5/8, 9/8, 3/2, 3/4,
<a name="line_69"></a>			 -8*Z*a_P^2/((Z+1)*a_P^4+(-6*Z+2)*a_P^2+Z+1));
<a name="line_70"></a>
<a name="line_71"></a>heun_F0 := unapply(heun_F00(Z) * heun_F01(Z),Z); <span style="color:red">#@ heun_F0
</span><a name="line_72"></a>heun_F1 := unapply(heun_F10(Z) * heun_F11(Z),Z); <span style="color:red">#@ heun_F1
</span><a name="line_73"></a>
<a name="line_74"></a># Images of some points v_H[i] under schwarz_psi_inv, as in
<a name="line_75"></a># Definition defn-schwarz-phi
<a name="line_76"></a>
<a name="line_77"></a>r_schwarz := (sqrt(2) - am_H)/ap_H;                                     <span style="color:red">#@ r_schwarz
</span><a name="line_78"></a>s_schwarz := (ap_H*am_H - sqrt(2)*(a_H - a_H^3))/(1 - a_H^2 + 2*a_H^4); <span style="color:red">#@ s_schwarz
</span><a name="line_79"></a>t_schwarz := a_H^2 * (sqrt(2)*ap_H - 2*a_H*am_H)/(1 - a_H^2 + 2*a_H^4); <span style="color:red">#@ t_schwarz
</span><a name="line_80"></a>
<a name="line_81"></a><span style="color:red">#@ v_HS
</span><a name="line_82"></a>v_HS[ 0] :=  r_schwarz;
<a name="line_83"></a>v_HS[ 1] := -r_schwarz;
<a name="line_84"></a>v_HS[ 2] :=  -I * am_H/(ap_H + sqrt(2)*a_H);
<a name="line_85"></a>v_HS[ 3] :=   I * am_H/(ap_H + sqrt(2)*a_H);
<a name="line_86"></a>
<a name="line_87"></a>v_HS[ 6] :=  0;
<a name="line_88"></a>
<a name="line_89"></a>v_HS[10] :=  t_schwarz - I * s_schwarz;
<a name="line_90"></a>v_HS[11] :=  t_schwarz + I * s_schwarz;
<a name="line_91"></a>v_HS[12] := -t_schwarz - I * s_schwarz;
<a name="line_92"></a>v_HS[13] := -t_schwarz + I * s_schwarz;
<a name="line_93"></a>
<a name="line_94"></a># Images of some curves c_H[i] under schwarz_psi_inv, as in
<a name="line_95"></a># Definition defn-schwarz-phi
<a name="line_96"></a>
<a name="line_97"></a><span style="color:red">#@ c_HS
</span><a name="line_98"></a>c_HS_p[3] := I * ap_H/am_H;
<a name="line_99"></a>c_HS_p[5] := (sqrt(2) + I*am_H)/ap_H;
<a name="line_100"></a>c_HS_r[3] := sqrt(2) * a_H / am_H;
<a name="line_101"></a>c_HS_r[5] := sqrt(2)*am_H/ap_H;
<a name="line_102"></a>
<a name="line_103"></a>c_HS[ 0] := (t) -> I * Tanh((t-Pi/4)*s_H[0]/Pi);
<a name="line_104"></a>c_HS[ 1] := (t) ->   - Tanh((t-Pi/2)*s_H[1]/Pi);
<a name="line_105"></a>c_HS[ 3] := (t) -> xi_curve(c_HS_p[3],2*(Pi/2-t)*s_H[2]/Pi);
<a name="line_106"></a>c_HS[ 5] := (t) -> xi_curve(c_HS_p[5],log((2+ap_H)/sqrt(3-a_H^2))-2*t*s_H[3]/Pi);
<a name="line_107"></a>
<a name="line_108"></a><span style="color:red">#@ v_PS
</span><a name="line_109"></a>v_PS[ 0] :=  1;
<a name="line_110"></a>v_PS[ 1] := -1;
<a name="line_111"></a>v_PS[ 2] := -I;
<a name="line_112"></a>v_PS[ 3] :=  I;
<a name="line_113"></a>v_PS[ 6] :=  0;
<a name="line_114"></a>
<a name="line_115"></a>v_PS[10] :=  (I + a_P)/(I - a_P);
<a name="line_116"></a>v_PS[11] :=  (I - a_P)/(I + a_P);
<a name="line_117"></a>v_PS[12] := -(I - a_P)/(I + a_P);
<a name="line_118"></a>v_PS[13] := -(I + a_P)/(I - a_P);
<a name="line_119"></a>
<a name="line_120"></a><span style="color:red">#@ c_PS
</span><a name="line_121"></a>c_PS[ 0] := (t) -> I * tan(t - Pi/4);
<a name="line_122"></a>c_PS[ 1] := (t) -> cos(t);
<a name="line_123"></a>c_PS[ 3] := unapply(simplify(schwarz_phi(p_P(c_P[ 3](t)))),t);
<a name="line_124"></a>c_PS[ 5] := unapply(simplify(schwarz_phi(p_P(c_P[ 5](t)))),t);
<a name="line_125"></a>
<a name="line_126"></a>
<a name="line_127"></a># This function corresponds to Definition defn-circle-fit
<a name="line_128"></a>
<a name="line_129"></a><span style="color:red">#@ series_circle_fit
</span><a name="line_130"></a>series_circle_fit := proc(u0,u1,u2)
<a name="line_131"></a> local T;
<a name="line_132"></a>
<a name="line_133"></a> T := table();
<a name="line_134"></a> T["c"] := sqrt(u2/(u0*(u0*u2+u1^2)));
<a name="line_135"></a> T["b"] := u1^2/sqrt(8*u0*u2*(u0*u2+u1^2)+u1^4);
<a name="line_136"></a> T["bp"] := sqrt(1 + T["b"]^2);
<a name="line_137"></a> T["bm"] := sqrt(1 - T["b"]^2);
<a name="line_138"></a> T["d"]  := T["bp"]/T["bm"];
<a name="line_139"></a> T["r"]  := sqrt(2)*T["b"]/T["bm"];
<a name="line_140"></a> return(eval(T));
<a name="line_141"></a>end:
<a name="line_142"></a>
<a name="line_143"></a><span style="color:red">#@ sample_circle_fit
</span><a name="line_144"></a>sample_circle_fit := proc(L)
<a name="line_145"></a> local N,XX,XY,YY,XXX,XXY,XYY,YYY,L1,z0,u1,v1,r1,T;
<a name="line_146"></a> N := nops(L);
<a name="line_147"></a> z0 := add(z,z in L)/N;
<a name="line_148"></a> L1 := map(z -> [Re(z-z0),Im(z-z0)],L);
<a name="line_149"></a> XX := add(a[1]^2      ,a in L1);
<a name="line_150"></a> XY := add(a[1]*a[2]   ,a in L1);
<a name="line_151"></a> YY := add(a[2]^2      ,a in L1);
<a name="line_152"></a> XYY := add(a[1]*a[2]^2,a in L1);
<a name="line_153"></a> XXY := add(a[1]^2*a[2],a in L1);
<a name="line_154"></a> XXX := add(a[1]^3     ,a in L1);
<a name="line_155"></a> YYY := add(a[2]^3     ,a in L1);
<a name="line_156"></a> u1 := (1/2)*(YY*N*XYY+YY*N*XXX-XY*N*XXY-XY*N*YYY)/(XX*N*YY-XY^2*N);
<a name="line_157"></a> v1 := (1/2)*(-XY*N*XYY-XY*N*XXX+XX*N*XXY+XX*N*YYY)/(XX*N*YY-XY^2*N);
<a name="line_158"></a> r1 := sqrt(XX/N+YY/N+(u1^2+v1^2));
<a name="line_159"></a>
<a name="line_160"></a> T := table():
<a name="line_161"></a> T["centre"] := z0+u1+I*v1;
<a name="line_162"></a> T["radius"] := r1;
<a name="line_163"></a>
<a name="line_164"></a> return(eval(T));
<a name="line_165"></a>end:
<a name="line_166"></a>
<a name="line_167"></a><span style="color:red">#@ tiny_p1_poles
</span><a name="line_168"></a>tiny_p1_poles := [I*am_H/ap_H,-I*am_H/ap_H];
<a name="line_169"></a>
<a name="line_170"></a><span style="color:red">#@ tiny_p1_denom
</span><a name="line_171"></a>tiny_p1_denom := (z) -> z^2 + (1-a_H^2)/(1+a_H^2);
<a name="line_172"></a>
<a name="line_173"></a><span style="color:red">#@ small_p1_poles
</span><a name="line_174"></a>small_p1_poles := map(simplify_H,[
<a name="line_175"></a> seq(schwarz_psi_inv(act_Pi(W,v_H[7])),W in
<a name="line_176"></a>    [[],[0],[2],[6],[0,6],[2,0],[2,3],[5,6],[2,0,6],[5,4,3],[0,7,0,6],[5,6,7,0,6]]),
<a name="line_177"></a> seq(schwarz_psi_inv(act_Pi(W,v_H[9])),W in
<a name="line_178"></a>    [[],[0],[2],[4],[0,2],[0,7],[2,4],[5,4],[0,2,4],[5,6,7],[0,2,1,2],[0,7,0,1,2]])
<a name="line_179"></a>]):
<a name="line_180"></a>
<a name="line_181"></a><span style="color:red">#@ small_p1_denom
</span><a name="line_182"></a>small_p1_denom := (z) -> 
<a name="line_183"></a>(z^4-2*z^2*(a_H^2+1)^2/(a_H^2-3)^2+(a_H^2+1)^2/(a_H^2-3)^2)*
<a name="line_184"></a>(z^4-2*z^2*(a_H^4-4*a_H^2+7)/(a_H^2-3)^2+(a_H^4+3)^2/((a_H^2-3)^2*(a_H^2+1)^2))*
<a name="line_185"></a>(z^4-2*z^2*(a_H^4+12*a_H^2-9)/(a_H^2-3)^2+(a_H^4+3)^2/((a_H^2-3)^2*(a_H^2+1)^2))*
<a name="line_186"></a>(z^4-2*z^2*(a_H^2+1)*(a_H^10+a_H^8-12*a_H^6+12*a_H^4+4*a_H^2-4)/(a_H^6-a_H^4-2)^2+(a_H^4-2*a_H^2+2)^2*(a_H^2+1)^2/(a_H^6-a_H^4-2)^2)*
<a name="line_187"></a>((-a_H^2+1)^2*(a_H^2+2)^2/((a_H^2-2)^2*(a_H^2+1)^2)+(2*(-a_H^2+1))*(a_H^2+2*a_H+2)*(a_H^2-2*a_H+2)*z^2/((a_H^2-2)^2*(a_H^2+1))+z^4)*
<a name="line_188"></a>(z^4-2*z^2*(a_H^2+1)*(a_H^10+a_H^8+4*a_H^6-4*a_H^4+4*a_H^2-4)/(a_H^6-a_H^4-2)^2+(a_H^4-2*a_H^2+2)^2*(a_H^2+1)^2/(a_H^6-a_H^4-2)^2);
<a name="line_189"></a>
<a name="line_190"></a><span style="color:red">#@ schwarz_b_approx
</span><a name="line_191"></a>schwarz_b_approx := (a) -> 0.9069138819607508504414623413486215941630984580580672212927769794572584355051327480722389917832436934-1.765474192590781737605598080177250320104598155751747434554168434791386658985099944462154268627034137*a+11.53828977378593312763653588864186488647822466461521372737570552945692216438365003085500639707627312*a^2-66.41329361574075935661075187078177669195661108874142415658152457434993361143811500196721781770233091*a^3+252.8047438337293960095779707025769471443777311418990076217550032752073341113370756286590049291734747*a^4-629.9078607801038186456330794089845793458290861471589728999709363487263998249145987081714492089597137*a^5+1020.358374393808620210881702144982983157533265009871970569144218800724280434738209698557221801944654*a^6-1048.740900936545828704047197583117104725092127778886883795987693295565268942430022674598654591538775*a^7+643.8321100777354751651656927733692084746561441636024348187111032073278314905473663698929203277312212*a^8-205.7057517407104396403773030537487539842131344061422435468478074909575133773836375067202807801834757*a^9+23.38607168239802899455924047642001005632471745805821178139327421692228478867776411933175717692491330*a^10:
<a name="line_192"></a>
<a name="line_193"></a><span style="color:red">#@ schwarz_c_approx
</span><a name="line_194"></a>schwarz_c_approx := (a) -> 0.2056091544987268220798370509160122242052513020545736786917007651838825344075819746412368048506824587+2.119297075747641460259319400109999804985002300201054267836014494876919786679576153075604342457731568*a-16.97540822063646794986589307304361914439032663427820975529588004577721559151722238273988798645387885*a^2+111.4327378813141625581053815667432701695777351827357767550594836286884557435518311962928179512904584*a^3-497.8280364102672996457064931256207794883799477913510984282768168044619968942609452870938085877487818*a^4+1476.634802306891170011190691150734072380963465242558167864043549037878387924612396089910412834763057*a^5-2911.486921527754435081165570561377274531794255693475113920098627252088320106419198173223937280420437*a^6+3764.776092932513000365494958037208518369588704079674268647925524858402564822809018562240131432396151*a^7-3062.124943339760129219656222429329602995172168558081544206872235816258108390142091508467676886602552*a^8+1419.161466628264212988621492211939809097559453474182385809990554936216592522540270481899308288835179*a^9-285.5632912305122964461160136643477626369817953502233169909822129018875329729882841139629237168807451*a^10:
<a name="line_195"></a>
<a name="line_196"></a><span style="color:red">#@ schwarz_d_approx
</span><a name="line_197"></a>schwarz_d_approx := (a) -> 0.6058377776502591150030967209491610331137537677546949034892689791801117384031868648857514189653909987/a^2-.5757005908854302939614660937646876562654754515805005628087462836547958761923587568388355714371388714/a+5.021674398133655864578418815878447581276579088374614078136131501609845114356760506017104132006848330-43.16353936606263677547932945959892277835334907696685728427630724492400682586012593021292899097419813*a+241.8407229892773138470807499563123837224094002654279722152557185141028854360356546579916505481536750*a^2-879.0714590308607269819325703549455540514915711553653262927964838656598213111121450666908004116820733*a^3+2076.040895943393049644902980965714646064319589501870239295214407029360258959685895189594048279798827*a^4-3142.620916760244192487301982269231601288293368722269041885451780412098378428607098882183962177408837*a^5+2932.327786651674606817506043850011956678724313527912316782251698822788840925528158290855391540457352*a^6-1532.037358618056904591964225256643925414126844321878829249902243192169256224299948152044642786850792*a^7+342.3168903638456056003706421234452452496222552478738690336322529610781181380798425890881658924475955*a^8:
<a name="line_198"></a>
  </pre>
 </body>
</html>
    